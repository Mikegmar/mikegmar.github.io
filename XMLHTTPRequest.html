<!DOCTYPE html>
<html>
  
    <head>
	<meta charset="UTF-8">	 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 	   
        <title>Using XMLHTTPRequest to Consume a JSON Web Service</title>            
    
        <!-- Custom style for this site -->
        <link href="/css/style.css" rel="stylesheet">	
        <!-- Normalize CSS -->
        <link href="/css/normalize.css" rel="stylesheet">
    </head>
	<header>       
	<nav>
        <ul id="menu" class="top">
          <li><a href="index.html">Home</a></li>		
        </ul>
	</nav>
        </header>	

              <header>
		
            <h3>Using XMLHTTPRequest to Consume a JSON Web Service</h3>
            <hr>
			
	        </header>
        
	<body>



<main>      
      <section>
        <h1>XMLHTTPRequest</h1>
	      <hr>
      <div class="code">
          <code><br>
            let xhr = new XMLHttpRequest();<br> 
            xhr.open("GET", url, false);<br>
            xhr.send();<br>
            // block of code to use response.
            
        </code>
        </div>
        <p>In the open function, there are 2 required arguments and 3 optional arguments. The first argument is either "GET" if requesting information or "POST" if sending information. The second argument is a URL for the server you are communicating with. The third argument is either  false for a synchronous request or true for asynchronous. If not suppied, the third argument will default to true. The fourth and fifth, not pictured here, are username and password. Some APIs require membership and payment for their service, so a username and password are required.</p>
        <h4>Asynchronous</h4>
        <p>Now let's look at an asynchronous XMLHTTPRequest. There are a couple of differences. After creating the new XMLHTTPRequest object, add an onreadystatechange function with the block of code to be executed after the response is received. Then add the open and send functions.</p>
        <div class="code">
          <code><br>
            let xhr = new XMLHttpRequest();<br>
            xhr.onreadystatechange = function () {<br>
            if (this.readyState == 4 && this.status == 200) {<br>
            //block of code to use response<br> 
            }};<br>
            xhr.open("GET", url, true);<br>
            xhr.send();<br>
              
        </code>
        </div>
        <p>The block of code is inside the onreadystate change function. This means it won't be executed until the response is received. Inside the function is an if statement to make sure the response has been fully downloaded and it is valid. Only then is the block executed.</p>
        <p>On the open function, notice that the third parameter is true for asynchronous XMLHTTPRequests.</p>
        <h4>Code block</h4>
        <p>The block of code in the examples above should contain instructions to process the response once it is received. The response will be in JSON format, so it will be a string. Use JSON.parse() to convert the string back into an object or array. Then the different properties can be accessed in the same way you would access any property from an object or array.</p>
        <div class="code">
          <code><br>
            let response = JSON.parse(xhr.responseText);<br>
            let lat = response.geocoding_results.RESULTS[0].COORDINATES.latitude;<br>
    let long = response.geocoding_results.RESULTS[0].COORDINATES.longitude;<br>
              
        </code>
        </div>
        <p>Below is a simple program to find out sunrise and sunset times for a particular day and location. Two XMLHTTPRequests are used. The first is synchronous. It sends a zipcode and receives latitude and longitude coordinates from geocode.farm. The second is asynchronous, and sends the latitude and longitude coordinates, along with a date, and receives sunrise and sunset times from sunrise-sunset.org. Then the response is converted with JSON.parse, and the sunrise and sunset times are converted from UTC time to the local timezone of the user's browser.</p>
      </section>
      
      <section>
        <h3>Time to Ride</h3>
        <p>Do you have enough time to get that bike ride in before or after work? Find out sunrise and sunset times for any day in any location in the USA. Enter the date and zip code below.</p>
        <p>The time zone will be set to your local time. If the zipcode is in a different time zone, you will need to convert the time.</p>
        <div id="sunrise"></div>
        <div id="coord"></div><br>
        <label for="zip">Enter Zipcode</label><input id="zip" value="91945"><br>
        <label for="day">Enter date</label><input id="day" value="01/30/2018" >
        <button id='btndate' onclick="sunset()">Get Sunset</button><br><br>
        <p>Information provided by geocode.farm and sunrise-sunset.org.</p>

      </section>
      
      		<hr>
		            <footer class="site-footer">
                <p>&copy Mike Mar  |  CIT261  |  Â© 2018 GitHub, Inc.</p>
       
          </footer>
    </body>
	
</html>
